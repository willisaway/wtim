<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.github.willisaway.user.dao.SmMenuMapper">
  <select id="selectIdByMap" parameterType="java.util.Map" resultType="java.lang.Long">
		select row_id from sm_menu
		<where>
			<if test="cm.parentId != null">
				and parent_id = #{parentId}
			</if>
			<if test="cm.customType != null">
				and custom_type = #{cm.customType}
			</if>
			<if test="cm.keyword != null and cm.keyword != ''">
				and (menu_name like CONCAT('%',#{cm.keyword},'%') or request_ like CONCAT('%',#{cm.keyword},'%'))
			</if>
			<if test="cm.userId != null">
				and (row_id not in (select a.menu_id from sm_menu_operation a where deleted_flag='0')
				or (row_id in (select a.menu_id from sm_role_menu a,sm_user_role b where a.role_id=b.role_id and a.deleted_flag='0' and b.deleted_flag='0' and b.user_id=#{cm.userId})
				or row_id in (select a.menu_id from sm_user_menu a where deleted_flag='0' and a.user_id=#{cm.userId}))
				)
			</if>
		</where>
		order by sort_no
	</select>
	<select id="getPermissions" resultType="java.util.Map">
		select CONCAT(m.row_id, code_) as value, CONCAT(menu_name, code_text) as text
		from sm_menu m
		join md_dic_index di on  di.key_='CRUD'
		join md_dic d on d.index_id=di.row_id
		order by m.row_id
	</select>


	<select id="queryListParentId" resultType="com.github.willisaway.user.model.SmMenu"></select>
	<select id="queryNotButtonList" resultType="com.github.willisaway.user.model.SmMenu"></select>
	<select id="getAllMenuList" resultType="com.github.willisaway.user.model.SmMenu"></select>
	<select id="getMenuListByUserId" resultType="com.github.willisaway.user.model.SmMenu"></select>
</mapper>